<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>ENTSO-E Online Grid Map</title>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.css' rel='stylesheet' />

    <link href='https://www.mapbox.com/base/latest/base.css' rel='stylesheet' />
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.12.3/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.12.3/mapbox-gl.css' rel='stylesheet' />
    <style>
        html, body { margin:0; padding:0; height:100%;}
        .row {max-width: inherit;}
        #map { position:relative; top:0; bottom:0; width:100%;height:100%;}
        #map_area {width: 100%; height:100%;margin: 0;padding: 0;}
        .mapboxgl-popup-close-button, .mapboxgl-popup-close-button:hover,.mapboxgl-ctrl-group > button {color:rgb(0, 0, 0);}
         .mapboxgl-popup-close-button {padding:3px 6px;}
        .mapboxgl-ctrl-group > button {margin:0;}
        .mapboxgl-popup-content {padding:15px 25px 15px;}
        .title {padding-top:1em;padding-bottom: .5em; margin-bottom:.5em; border-bottom: 1px solid #3c3c3c; }
        #features {}
         ul li .properties {margin-left:30px;min-height: 100px;}
         ul li .station {font-size: 12px;
          padding: 10px 0;
          margin-right: 30px;
          white-space: nowrap;
          overflow: hidden;
          height: 37px;}
         ul li {display: block;
                position: relative;
                border-bottom: 1px solid #EDECE9;
                cursor: pointer;
            }
        ul li .voltage::after {content:' kV';}
        ul li .line-props {width: 25%;float: left;font-size: 14px;font-weight: 400;color: #737c81;}
        ul li .investment {display: block;padding-bottom: 10px;}
        ul li .invest {display: inline-block;font-size: 14px;font-weight: 400;color: #737c81;padding-right: 10px;}

        .promotor:before{content:' promotor';}
        .invest_type:before{content:' invest type';}
        .commissioning:before{content:'commissioning';}
        .promotor:before,  .invest_type:before, .commissioning:before {
          display: block;
          font-size: 9px;
          color: #222222;
        }


        ul li .line-props:last-child{width:50%;}
        
        .routeLine._154{background-color: #47B584;}
        .routeLine._220,.routeLine._275 {background-color: #47B584;}
        .routeLine._400,.routeLine._330,.routeLine._380 {background-color: #F70C0C;}
        .routeLine.DC {background-color: #AC007E;}

        ul li .routeLine {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            position: absolute;
            width: 2px;
            height: 90%;
            background-color: #D8D8D8;
            left: 10px;
            top: 78px;
            height: 62px;
            transition: height 0.25s,top 0.25s;
            transition-delay: 0.05s;
            transition-timing-function: ease-in-out;
        }
        ul li .routeLine div:first-child {
    margin-top: -3px;
}
ul li .routeLine div:last-child {
    position: absolute;
    bottom: -3px;
}
ul li .routeLine > div {
    width: 10px;
    height: 10px;
    background-color: #D8D8D8;
    border-radius: 8px;
    margin-left: -4px;
    font-size: 10px;
    line-height: 10px;
    text-align: center;
    color: transparent;
    transition: width 0.25s,height 0.25s,margin-left 0.25s,color 0.25s,line-height 0.25s;
    transition-delay: 0.05s;
    transition-timing-function: ease-in-out;
}
.key-stats >li {border-right: 5px solid #CCC;padding:10px;color:#fff; background: #acc23a;}
.dot{border-radius:50%;margin-right:5px;display:inline-block !important;}
.line{margin-right:5px;display:inline-block !important;padding: 3px 10px;border-radius: 0;margin-bottom: 3px;}
.fill-keynote{background-color:#f04124;}
.fill-new-station {background-color:#7D9A46;}
.fill-up-station {background-color:rgba(1,1,1,1);}
.fill-750kv{background-color:rgba(32,72,128,1);}
.fill-500kv{background-color:rgba(168,0,0,1);}
.fill-400kv{background-color:rgba(237,17,17,1);}
.fill-300kv{background-color:rgba(224,140,22,1);}
.fill-220kv{background-color:rgba(10,105,10,1);}
.fill-110kv{background-color:rgba(0,0,0,1);}
.fill-dc{background-color:#ac007e;}
.fill-exist{background-color:#d6d6d6;}
.fill-bubble{background-color:#e1dcd3;border:1px solid #000;padding: 5px 10px;margin-bottom: 0px;}
#legend > ul li {border-bottom: 0px;padding-right:10px;}
#legend {border-bottom:2px solid #D8D7D3;margin-top:0px;border-top:1px solid #D8D7D3;padding-top:10px;}
body {background: #FAF9F7;}

.mapboxgl-popup-content {
    max-width: 300px;
}
.bg_icon {    padding: 5px 8px 5px 9px;
    margin-bottom: 0px;
    background-image: url(https://api.mapbox.com/styles/v1/rusty/cijftgxlo0035aim4b01kmevc/sprite.png?access_token=pk.eyJ1IjoicnVzdHkiLCJhIjoib0FjUkJybyJ9.V9QoXck_1Z18MhpwyIE2Og);
    height: 14px;
    width: 10px;
    background-repeat: no-repeat;
    display: inline-block !important;
    background-size: cover;margin-right: 4px;} 
.line-cons{background-image: url(./img/stations/line-const.svg);}
.sub{background-image: url(./img/stations/Substation_UO.svg);}
.ps{background-image: url(./img/stations/Hydro_Pump_storage_UO.svg);}
.rs{background-image: url(./img/stations/Hydro_Run-of_river_UO.svg);}
.bs {background-image: url(./img/stations/Biomass_UO.svg);}
.con{background-image: url(./img/stations/Converter_station_UO.svg);}
.gas{background-image: url(./img/stations/Fossil_fuel_Gas_UO.svg);}
.wind{background-image: url(./img/stations/Wind_UO.svg);}
.nc{background-image: url(./img/stations/Nuclear_UO.svg);}
.solar{background-image: url(./img/stations/Solar_UO.svg);}
.coal{background-image: url(./img/stations/Fossil_fuel_Hard_coal_UO.svg);}
.other{background-image: url(./img/stations/other_UO.svg);}
.cons_hor{background-image: url(./img/stations/cons_hor.svg);}
.cons_dia{background-image: url(./img/stations/cons_dia.svg);}

    .legend1 {
      position: absolute;
    right: 10px;
    bottom: 10px;
    background-color: #ffffff;
    padding: 5px;
    z-index: 10000000;
    width: 275px;
    font-weight: normal;
    text-align: left;
    }
    #menu {
        position: absolute;
        background: #fff;
        padding: 10px;
        font-family: 'Open Sans', sans-serif;
        top:120px;
        left: 0;
        margin-top: 10px;
        margin-left: 25px;
    }
    input#v2, input#v3 {margin-top: 5px;
        margin-bottom: 0;}
    </style>
</head>
<body>
<style>
    
</style>
  <div class="row" style="height:100%;">
    <div class="large-3 columns">
    <div class="logo">
        <h2 style="padding-top: 1em;padding-bottom: .5em;margin-bottom: .5em;border-bottom: 0px;padding-bottom: 0;border-bottom:0px;">
        <a href="#" style="color:#63b6e5;">ENTSO-E Transmission System</a>
        </h2>
       
    </div>
      <div id="legend" class="legends">
      <strong>Lines </strong>
       <ul class="inline-list">
        <li></li>
        <li><span class="line fill-750kv"></span>750kV</li>
        <li><span class="line fill-500kv"></span>500kV</li>
        <li><span class="line fill-400kv"></span>380-400kV</li>
        <li><span class="line fill-300kv"></span>300-320kV</li>
        <li><span class="line fill-220kv"></span>220kV</li>
        <li><span class="line fill-110kv"></span>132-150kV</li>
        <li><span class="line fill-110kv"></span>110kV</li>
        <li><span class="line fill-dc"></span>DC</li>
        <li><span class="bg_icon line-cons" style=""></span>2 or more circuts</li>
        </ul>
        <strong>Stations &amp; Powerplants</strong>
        <ul class="inline-list">
        <li><span class="bg_icon sub" style=""></span>Substation</li>
        <li><span class="bg_icon con"></span>DC Converter</li>
        <li><span class="bg_icon ps"></span>Pump Storage</li>
        <li><span class="bg_icon rs"></span>River + Storage</li>
        <li><span class="bg_icon bs"></span>Biomass</li>
        <li><span class="bg_icon gas"></span>Gas</li>
        <li><span class="bg_icon nc"></span>Nuclear</li>
        <li><span class="bg_icon coal"></span>Coal</li>
        <li><span class="bg_icon wind"></span>Wind</li>
        <li><span class="bg_icon solar"></span>Solar</li>
        <li><span class="bg_icon other"></span>Other</li>
        <li style="display: block;width: 100%;"><span class="bg_icon cons_hor"></span><span class="bg_icon cons_dia"></span>Under Construction</li>
       </ul>
      </div>
      <div class="copyright">
        <p>&copy; ENTSO-E. Map data is accurate as of February 2015.</p>
      </div>
  </div>
    
    
    <div class="large-9 columns" style="height:100%;">
      <div id="map_area">

        <div id='map'></div>
        <div id='menu'>
          <label>Switch Between Styles</label>
          <input id='v5' type='radio' name='rtoggle' value='v4' checked='checked'>
          <label for='v5'>version 4</label> <br>
          <input id='v3' type='radio' name='rtoggle' value='v3'>
          <label for='v3'>version 3</label> <br>
          <input id='v2' type='radio' name='rtoggle' value='v2' >
          <label for='v2'>version 2</label>
        </div>
      </div>
    </div>
    
  </div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicnVzdHkiLCJhIjoib0FjUkJybyJ9.V9QoXck_1Z18MhpwyIE2Og';
if (!mapboxgl.supported()) {
    alert('Your browser does not support Mapbox GL');
} else {
    var map = new mapboxgl.Map({
        container: 'map',
        style: './ee_map_v5.json',
        center: [12.013, 50.254],
        zoom: 4.0,
        hash: true
    });

    map.addControl(new mapboxgl.Navigation({position: 'top-left'}));

    

    map.on('click', function(e) {
          map.featuresAt(e.point, {radius: 3, includeGeometry:false}, function(err, features) {
              if (err) throw err;
              
              clickedFeatures = []

              for (var i = features.length - 1; i >= 0; i--) {
                feature = features[i]
               
                if (feature['layer']['source'] == "mapbox://rusty.02rit83j" || feature['layer']['source'] == "mapbox://rusty.cm0b8gzp"){
                    clickedFeatures.push(feature.properties)
                }
              };
              console.log(JSON.stringify(clickedFeatures, null, 2));

              console.log("Zoom: " + map.getZoom())
              popUp = ''
              
              for (var i = clickedFeatures.length - 1; i >= 0; i--) {
                feature = clickedFeatures[i]
                
                popUp += '<div><strong>'+feature['symbol']+'</strong></div>'
                if (feature['name_eng']) {
                  popUp += '<div>'+feature['name_eng']+'</div>'
                };
                if (feature['country_1']) {
                  popUp += '<div>'+feature['country_1']+' &mdash; ' +feature['country_2']+'</div>'
                };
                popUp += '<hr />'

            };

            if (clickedFeatures.length > 0) {
              var tooltip = new mapboxgl.Popup({anchor: 'top-left'})
                .setLngLat(e.lngLat)
                .setHTML(popUp)
                .addTo(map);
            } else {
              //info.innerHTML = '<p><strong>Select a line, station or bubble for more information.</strong></p>';
            }
            
          });
          
      });

// layer switcher
var layerList = document.getElementById('menu');
      var inputs = layerList.getElementsByTagName('input');

    function switchLayer(layer) {
        var layerId = layer.target.id;
        map.setStyle('./ee_map_' + layerId + '.json');
    }

    for (var i = 0; i < inputs.length; i++) {
        inputs[i].onclick = switchLayer;
    }


}



</script>

</body>
</html>